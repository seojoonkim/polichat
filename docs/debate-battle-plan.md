# 🥊 AI 토론 배틀 모드 — 상세 기획서

> **polichat** 신규 기능: 오세훈 vs 정원오 실시간 AI 토론
> 작성일: 2026-02-18

---

## 목차
1. [UX 플로우 설계](#1-ux-플로우-설계)
2. [토론 주제 10개](#2-토론-주제-10개)
3. [토론 방식 4가지 상세 설계](#3-토론-방식-4가지-상세-설계)
4. [기술 설계](#4-기술-설계)
5. [토론 캐싱 시스템](#5-토론-캐싱-시스템)
6. [UI/UX 디자인 명세](#6-uiux-디자인-명세)
7. [승자 판정 시스템](#7-승자-판정-시스템)

---

## 1. UX 플로우 설계

### 1-1. 메인 화면 → 토론 배틀 진입

```
┌─────────────────────────────┐
│  polichat                    │
│                              │
│  [오세훈 1:1 채팅]           │
│  [정원오 1:1 채팅]           │
│  ...                         │
│                              │
│  ╔═══════════════════════╗   │
│  ║ 🥊 토론 배틀 모드      ║   │
│  ║ 오세훈 vs 정원오       ║   │
│  ║ "서울의 미래를 건다"    ║   │
│  ╚═══════════════════════╝   │
│                              │
└─────────────────────────────┘
```

- 메인 화면 상단에 **배너 카드**로 노출
- 두 후보 프로필 이미지 좌우 배치 + VS 아이콘
- 탭 하면 **설정 화면**으로 이동

### 1-2. 설정 화면 (3단계)

**Step 1: 주제 선택**
```
┌─────────────────────────────┐
│ ← 토론 배틀 설정             │
│                              │
│ 📌 토론 주제를 선택하세요     │
│                              │
│ [🏗️ 재개발 vs 도시재생]      │
│ [🏠 주거 정책]               │
│ [💰 지역경제]                │
│ [🌿 환경]                    │
│ [👶 돌봄·복지]               │
│ [🚇 교통]                    │
│ [📊 강남북 격차]             │
│ [🧑‍💼 청년 정책]              │
│ [🏛️ 행정 혁신]              │
│ [🎨 도시 브랜딩]             │
│                              │
│       [다음 →]               │
└─────────────────────────────┘
```

**Step 2: 방식 선택**
```
┌─────────────────────────────┐
│ ← 토론 방식 선택             │
│                              │
│ 🎯 자유 토론                 │
│   자유롭게 공방하는 토론      │
│                              │
│ 📋 정책 디베이트             │
│   구조화된 찬반 토론          │
│                              │
│ 🏘️ 시민 타운홀              │
│   시민 질문에 두 후보 응답    │
│                              │
│ ⚡ 최후 변론 배틀             │
│   1분 최후변론 + 즉시 판정   │
│                              │
│       [토론 시작! 🥊]        │
└─────────────────────────────┘
```

**Step 3: 토론 시작 → 진행 화면 전환**
- 카운트다운 3, 2, 1 애니메이션 후 토론 시작

### 1-3. 토론 진행 화면

```
┌─────────────────────────────────────┐
│ 🥊 자유 토론 — 재개발 vs 도시재생    │
│ ━━━━━━━━━━━━━━━ 라운드 2/5 ━━━━━━━  │
│                                      │
│ ┌──────────┐    ┌──────────┐        │
│ │  오세훈   │ VS │  정원오   │        │
│ │  🔵      │    │  🔴      │        │
│ └──────────┘    └──────────┘        │
│                                      │
│ ┌─────────────────────────────────┐ │
│ │ 💬 오세훈 (발언 중... ⏱️ 0:42)  │ │
│ │                                  │ │
│ │ "서울의 낡은 주거환경을 개선하려 │ │
│ │  면 재건축·재개발이 불가피합니다. │ │
│ │  제가 추진한 신속통합기획은..."   │ │
│ │                                  │ │
│ │ 💬 정원오                        │ │
│ │                                  │ │
│ │ "재개발이 답이 아닙니다. 성수동  │ │
│ │  을 보세요. 원주민을 지키면서도  │ │
│ │  도시를 살릴 수 있습니다..."     │ │
│ └─────────────────────────────────┘ │
│                                      │
│ [📢 시민 질문하기]  [⏭️ 다음 라운드] │
└─────────────────────────────────────┘
```

### 1-4. 토론 종료 화면

```
┌─────────────────────────────────────┐
│          🏆 토론 종료!               │
│                                      │
│    오세훈  ⚡ VS ⚡  정원오           │
│                                      │
│  ┌──────── AI 판정 결과 ────────┐   │
│  │                               │   │
│  │  🏆 이번 토론의 승자:         │   │
│  │     정원오 (57 : 43)          │   │
│  │                               │   │
│  │  📊 평가 항목:                │   │
│  │  논리력:    ████░░ vs ██████  │   │
│  │  구체성:    █████░ vs ████░░  │   │
│  │  설득력:    ████░░ vs █████░  │   │
│  │  실현가능:  ██████ vs ███░░░  │   │
│  │                               │   │
│  │  💬 AI 총평:                  │   │
│  │  "정원오 후보는 성동구 사례를  │   │
│  │   구체적으로 제시하며..."      │   │
│  └───────────────────────────────┘   │
│                                      │
│  [🔄 다시 토론]  [📤 공유]  [🏠 홈]  │
└─────────────────────────────────────┘
```

---

## 2. 토론 주제 10개

두 후보의 실제 정책 데이터를 기반으로 선정했습니다.

| # | 주제 | 오세훈 입장 | 정원오 입장 |
|---|------|-----------|-----------|
| 1 | **재개발 vs 도시재생** | 35층 제한 폐지, 신속통합기획으로 재건축·재개발 규제 완화 | 주민참여형 도시재생, 원주민 보호하며 공동체 살리기 |
| 2 | **젠트리피케이션 대응** | 시장 자율에 맡기되 균형발전 도모 (재산세 공동과세) | 전국 최초 젠트리피케이션 방지 조례, 상생협약 의무화 |
| 3 | **주거 정책 방향** | 공급 확대 (용적률 상향, 모아타운, 후분양제) | 공공임대 확충, 주거급여 강화, 집수리 지원 |
| 4 | **복지: 선별 vs 보편** | 선별적 복지 (무상급식 반대로 시장직 사퇴한 소신) | 보편적 복지 ("복지는 시혜가 아니라 권리") |
| 5 | **강남북 격차 해소** | 재산세 공동과세로 세입 격차 16.6배→4.7배 축소 | 사회적경제·마을기업으로 자생력 키우는 상향식 접근 |
| 6 | **교통 인프라** | GTX-A 개통, 동북선·서부선 등 대형 인프라 투자 | 친환경 교통(전기차, 자전거), 대중교통 접근성 강화 |
| 7 | **환경·탄소중립** | 한강르네상스 2.0, CNG 버스 전환, 녹지 423만㎡ 조성 | 에너지 자립마을, 그린뉴딜, 도시농업 활성화 |
| 8 | **청년 정책** | 글로벌 금융허브 육성, 창업 생태계, 청년취업사관학교 | 소셜벤처 밸리 조성, 사회적기업 청년창업 지원 |
| 9 | **행정 혁신** | 다산콜센터 120, 원스트라이크아웃제, 공무원 1300명 감축 | 찾아가는 동주민센터, 민원서비스 대통령상 8회 |
| 10 | **도시 브랜딩 전략** | 디자인 서울(DDP, 세빛섬), 세계디자인수도, 국제 경쟁력 9위 | 성수동 수제화거리·소셜벤처밸리, 사람 중심 도시 정체성 |

---

## 3. 토론 방식 4가지 상세 설계

### 방식 1: 🗣️ 자유 토론

**컨셉**: 사회자 없이 두 후보가 자유롭게 공방. 가장 다이나믹.

**라운드 구조**:
| 단계 | 내용 | 시간(글자) |
|------|------|----------|
| 오프닝 | 각 후보 입장 표명 | 각 200자 |
| 라운드 1~3 | 자유 공방 (교차 발언) | 각 300자 × 2명 × 3라운드 |
| 클로징 | 마무리 발언 | 각 200자 |
| **총** | **8회 발언** | **약 2,600자** |

**발언 순서**: 주제 관련 현직 우위자 → 도전자 교대. 각 발언은 상대 발언을 반드시 반박/인용하도록 프롬프트에 명시.

**AI 프롬프트 전략**:
```
[시스템] 당신은 오세훈 서울시장입니다.
- 변호사 출신의 논리적이고 체계적인 화법
- 숫자와 성과를 구체적으로 제시
- "서울 시민 여러분" 등 공식적 호칭
- 상대 발언의 약점을 조목조목 반박
- 자신감 있고 당당하되, 품위 유지
- 1기/2기 시장 경험의 구체적 성과를 근거로 제시

[규칙]
- 상대방 직전 발언을 반드시 1개 이상 인용/반박
- 300자 이내로 발언
- 인신공격 금지, 정책 논쟁에 집중
```

```
[시스템] 당신은 정원오 성동구청장입니다.
- 서민적이고 친근한 화법, 현장 경험 인용
- "현장에서 직접 확인했습니다" 스타일
- 사람·공동체 중심 가치 강조
- 성동구 3선 구청장의 실제 성과를 근거로 제시
- 따뜻하지만 단호하게 반박
- 쉬운 말로 시민 눈높이에 맞춰 설명

[규칙]
- 상대방 직전 발언을 반드시 1개 이상 인용/반박
- 300자 이내로 발언
- 인신공격 금지, 정책 논쟁에 집중
```

**예시 발언 샘플 (주제: 재개발 vs 도시재생)**:

> **오세훈**: "서울에는 30년 이상 된 노후 아파트가 전체의 절반을 넘습니다. 주민들이 안전한 환경에서 살 권리가 있어요. 제가 추진한 신속통합기획은 재건축 기간을 획기적으로 단축시켰고, 35층 층수 제한 폐지로 도시 경쟁력을 높였습니다. 도시재생이 좋은 취지지만, 서울 전체의 주거 문제를 해결하기엔 속도와 규모가 부족합니다."

> **정원오**: "오 시장님, 재개발로 속도를 내겠다고 하시지만, 그 속도 때문에 쫓겨나는 원주민은 누가 책임집니까? 성수동을 보세요. 저는 젠트리피케이션 방지 조례를 전국 최초로 만들어서, 개발하면서도 원래 살던 분들을 지켰습니다. 건물만 새로 짓는 게 아니라 사람과 공동체를 살리는 게 진짜 도시 발전입니다."

---

### 방식 2: 📋 정책 디베이트

**컨셉**: 구조화된 찬반 토론. 각 후보가 주제에 대한 정책을 체계적으로 발표하고 교차질문.

**라운드 구조**:
| 단계 | 내용 | 시간(글자) |
|------|------|----------|
| 입론 1 | 후보A 정책 발표 | 400자 |
| 입론 2 | 후보B 정책 발표 | 400자 |
| 교차질문 1 | A→B 질문 + B 답변 | 질문 100자 + 답변 200자 |
| 교차질문 2 | B→A 질문 + A 답변 | 질문 100자 + 답변 200자 |
| 반박 1 | 후보A 반박 | 250자 |
| 반박 2 | 후보B 반박 | 250자 |
| **총** | **8회 발언** | **약 1,900자** |

**AI 프롬프트 추가 전략**:
- 입론: "구체적 정책명, 예산, 기대효과를 포함하여 발표하세요"
- 교차질문: "상대 입론의 가장 취약한 부분을 날카롭게 질문하세요"
- 반박: "교차질문에서 드러난 상대 약점을 공격하면서 자신의 정책 우위를 정리하세요"

**예시 (교차질문)**:

> **정원오 → 오세훈**: "오 시장님, 35층 제한 폐지와 용적률 상향으로 공급을 늘리겠다고 하셨는데, 2기 시장 취임 후 실제로 입주 가능한 주택이 몇 호나 늘었습니까?"

> **오세훈 답변**: "좋은 질문이십니다. 신속통합기획으로 현재 수십 곳의 정비사업이 진행 중이고, 이는 기존 대비 사업 기간을 3~5년 단축하는 성과입니다. 단기 입주 물량보다 중장기적 공급 파이프라인을 만드는 것이 핵심입니다."

---

### 방식 3: 🏘️ 시민 타운홀

**컨셉**: 사용자가 직접 질문을 던지면 두 후보가 순서대로 답변. 가장 인터랙티브.

**라운드 구조**:
| 단계 | 내용 | 시간(글자) |
|------|------|----------|
| 시민 질문 | 사용자 입력 or 추천 질문 선택 | 자유 |
| 후보A 답변 | 먼저 답변 (랜덤 순서) | 300자 |
| 후보B 답변 | 상대 답변 참고하여 답변 | 300자 |
| 보충 공방 | 선택적: 추가 반박 1회씩 | 각 150자 |
| **반복** | **3~5 질문** | **질문당 ~900자** |

**특별 기능**:
- **추천 질문 5개**: 주제별로 미리 준비된 시민 질문
- **직접 질문**: 사용자가 자유롭게 입력
- **팔로업**: 답변 후 "더 자세히" 버튼으로 추가 질문 가능

**AI 프롬프트 추가 전략**:
- "시민이 직접 질문한 것이므로, 쉽고 구체적으로 답변하세요"
- "상대 후보의 답변을 듣고 차별점을 부각하세요"
- "추상적 약속이 아닌 구체적 사업명과 수치로 답하세요"

**예시**:

> **시민 질문**: "성수동 같은 핫플레이스에서 원래 살던 주민들은 어떻게 보호하나요?"

> **정원오**: "제가 직접 만든 정책이라 자신 있게 말씀드립니다. 2015년에 전국 최초로 젠트리피케이션 방지 조례를 만들었어요. 건물주와 세입자가 상생협약을 맺어 임대료 급등을 막고, 구청 소유 상생상가를 저렴하게 임대해 소상공인을 지킵니다. 성수동이 지금처럼 뜰 수 있었던 건 원주민을 쫓아내지 않았기 때문입니다."

> **오세훈**: "저도 균형발전을 중시합니다. 1기 시절 재산세 공동과세를 도입해 강남북 격차를 16.6배에서 4.7배로 줄였습니다. 하지만 조례만으로는 한계가 있어요. 서울 전체 차원에서 공급을 늘리고 다핵 도시를 만들어야 특정 지역에 수요가 몰리는 근본 문제를 해결할 수 있습니다."

---

### 방식 4: ⚡ 최후 변론 배틀

**컨셉**: 가장 짧고 강렬한 모드. 핵심만 말하는 최후변론 + 즉시 AI 판정.

**라운드 구조**:
| 단계 | 내용 | 시간(글자) |
|------|------|----------|
| 최후변론 A | 후보A 핵심 주장 | 250자 (엄격) |
| 최후변론 B | 후보B 핵심 주장 | 250자 (엄격) |
| AI 판정 | 즉시 승패 판정 + 한줄 평 | 자동 |
| **총** | **2회 발언 + 판정** | **~600자** |

**AI 프롬프트 전략**:
- "이것이 마지막 발언입니다. 시민의 마음을 사로잡을 가장 핵심적인 메시지를 전달하세요"
- "구체적 성과 1개 + 미래 비전 1개를 반드시 포함하세요"
- "감성과 논리를 모두 담아 호소하세요"

**예시 (주제: 서울의 미래)**:

> **오세훈**: "저는 집이 없어 초등학교를 4번 전학 다닌 아이였습니다. 그래서 압니다, 서울이 어떤 도시여야 하는지. 다산콜센터, DDP, GTX, 한강르네상스 — 20년간 서울을 바꿔온 경험과 실행력이 있습니다. 서울을 아시아 넘버원 도시로 만들겠습니다."

> **정원오**: "화려한 건물이 도시의 경쟁력이 아닙니다. 사람이 경쟁력입니다. 저는 성동구에서 증명했습니다. 젠트리피케이션을 막으면서도 성수동을 서울의 핫플레이스로 만들었고, 대통령상을 8번 받았습니다. 서울 전체에 '사람이 쫓겨나지 않는 발전'을 실현하겠습니다."

---

## 4. 기술 설계

### 4-1. API 설계

#### 토론 세션 생성
```
POST /api/debate/start
```
**Request:**
```json
{
  "topicId": "redevelopment",
  "mode": "free" | "policy" | "townhall" | "final",
  "candidateA": "ohsehoon",
  "candidateB": "jungwono"
}
```
**Response:**
```json
{
  "debateId": "dbt_abc123",
  "status": "ready",
  "topic": { "id": "redevelopment", "title": "재개발 vs 도시재생", ... },
  "mode": "free",
  "rounds": [
    { "round": 1, "type": "opening", "speaker": "ohsehoon", "maxChars": 200 },
    { "round": 2, "type": "opening", "speaker": "jungwono", "maxChars": 200 },
    ...
  ]
}
```

#### 다음 발언 생성 (스트리밍)
```
POST /api/debate/{debateId}/next
```
**Request:**
```json
{
  "round": 3,
  "speaker": "ohsehoon"
}
```
**Response:** `text/event-stream` (SSE)
```
data: {"type":"token","content":"서울"}
data: {"type":"token","content":"의"}
data: {"type":"token","content":" 낡은"}
...
data: {"type":"done","fullText":"서울의 낡은...","charCount":287}
```

#### 시민 질문 (타운홀 모드)
```
POST /api/debate/{debateId}/question
```
**Request:**
```json
{
  "question": "성수동 주민 보호는 어떻게?"
}
```

#### 판정 요청
```
POST /api/debate/{debateId}/judge
```
**Response:**
```json
{
  "winner": "jungwono",
  "score": { "ohsehoon": 43, "jungwono": 57 },
  "criteria": {
    "logic": { "ohsehoon": 7, "jungwono": 8 },
    "specificity": { "ohsehoon": 8, "jungwono": 7 },
    "persuasion": { "ohsehoon": 6, "jungwono": 8 },
    "feasibility": { "ohsehoon": 8, "jungwono": 7 }
  },
  "summary": "정원오 후보는 성동구 사례를 구체적으로..."
}
```

### 4-2. 상태 관리

```typescript
interface DebateState {
  debateId: string;
  status: 'setting' | 'ready' | 'in-progress' | 'judging' | 'completed';
  topic: Topic;
  mode: DebateMode;
  currentRound: number;
  totalRounds: number;
  messages: DebateMessage[];
  isStreaming: boolean;
  currentSpeaker: CandidateId | null;
  judgment?: Judgment;
}

interface DebateMessage {
  round: number;
  speaker: CandidateId;
  type: 'opening' | 'argument' | 'question' | 'answer' | 'rebuttal' | 'closing';
  content: string;
  charCount: number;
  timestamp: number;
}
```

**상태 전이**:
```
setting → ready → in-progress → judging → completed
                      ↕
                  (각 라운드 반복)
```

### 4-3. 스트리밍 처리

```typescript
// SSE 기반 스트리밍
const generateSpeech = async (debateId: string, round: number) => {
  const response = await fetch(`/api/debate/${debateId}/next`, {
    method: 'POST',
    body: JSON.stringify({ round, speaker: currentSpeaker }),
  });

  const reader = response.body.getReader();
  const decoder = new TextDecoder();

  while (true) {
    const { done, value } = await reader.read();
    if (done) break;

    const chunk = decoder.decode(value);
    // SSE 파싱 → UI 업데이트
    appendToCurrentMessage(chunk);
  }
};
```

**핵심 포인트**:
- 각 발언을 개별 API 호출로 생성 (이전 대화 컨텍스트 전달)
- 스트리밍으로 실시간 타이핑 효과
- 발언 완료 후 자동으로 다음 라운드 트리거 (2초 딜레이)

### 4-4. 타이머 구현

- **글자 수 기반** (시간 타이머 X): AI가 생성하므로 maxChars로 제어
- UI에는 **발언 진행률 바** 표시 (현재글자/최대글자)
- 라운드 간 전환 시 **2초 인터벌** (애니메이션용)
- 전체 토론 진행률: 상단 프로그레스바 (현재라운드/전체라운드)

---

## 5. 토론 캐싱 시스템 ⭐ (핵심 기능)

> 형이 직접 제안한 비용 최적화 전략. 토론 배틀의 경제성을 좌우하는 핵심 설계.

### 5-1. 개념

```
주제 10개 × 방식 4가지 = 40개 조합
각 조합 → 최초 1회만 Claude API 호출 → Supabase 저장
이후 동일 조합 → 캐시에서 불러와 타이핑 애니메이션 재생
```

- 사용자는 **실시간 생성인지 캐시 재생인지 구분 불가**
- API 비용: 최대 40회 호출로 끝 (이후 0원)
- 최초 생성 시 충분히 신중하게 고품질 토론 생성 가능

### 5-2. Supabase 스키마

```sql
CREATE TABLE debate_cache (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  topic_id TEXT NOT NULL,           -- 'redevelopment', 'gentrification', ...
  mode TEXT NOT NULL,               -- 'free', 'policy', 'townhall', 'final'
  candidate_a TEXT NOT NULL,        -- 'ohsehoon'
  candidate_b TEXT NOT NULL,        -- 'jungwono'
  messages JSONB NOT NULL,          -- 전체 토론 대화 배열
  judgment JSONB NOT NULL,          -- 판정 결과
  version INT DEFAULT 1,           -- 재생성 시 버전 관리
  created_at TIMESTAMPTZ DEFAULT now(),
  
  UNIQUE(topic_id, mode, candidate_a, candidate_b)
);

-- messages JSONB 구조:
-- [
--   {
--     "round": 1,
--     "speaker": "ohsehoon",
--     "type": "opening",
--     "content": "안녕하십니까, 서울시장 오세훈입니다...",
--     "charCount": 198
--   },
--   ...
-- ]
```

### 5-3. 캐시 플로우

```
사용자: 주제 + 방식 선택 → 토론 시작
           │
           ▼
  ┌─ debate_cache에 해당 조합 있나? ─┐
  │                                   │
  YES                                 NO
  │                                   │
  ▼                                   ▼
캐시 재생 모드                    실시간 생성 모드
  │                                   │
  ▼                                   ▼
저장된 messages를                Claude API 호출
글자당 30~50ms로                 SSE 스트리밍
타이핑 애니메이션 재생            │
  │                               ▼
  │                          생성 완료 → Supabase 저장
  │                               │
  ▼                               ▼
         판정 결과 표시
```

### 5-4. 캐시 재생 구현

```typescript
// 캐시 재생 — 실시간처럼 보이는 타이핑 애니메이션
const playFromCache = async (messages: DebateMessage[]) => {
  for (const msg of messages) {
    // 발언자 전환 연출 (2초 딜레이)
    setCurrentSpeaker(msg.speaker);
    await delay(2000);
    
    // 글자 단위 타이핑 (30~50ms 랜덤)
    let displayed = '';
    for (const char of msg.content) {
      displayed += char;
      updateMessageUI(msg.speaker, displayed);
      await delay(30 + Math.random() * 20); // 30~50ms
    }
    
    // 발언 완료 후 잠시 대기 (읽는 시간)
    await delay(1500);
  }
};
```

**자연스러운 재생 포인트**:
- 글자당 30~50ms 랜덤 딜레이 (일정 속도 X)
- 문장 끝(마침표, 물음표)에서 살짝 더 느리게 (100ms)
- 발언자 전환 시 2초 인터벌
- 스크롤 자동 따라감

### 5-5. API 변경

```
POST /api/debate/{debateId}/next
```
**Response에 캐시 여부 포함** (프론트에서 분기):
```json
{
  "source": "cache" | "live",
  "messages": [...],     // cache일 때: 전체 메시지 배열
  "stream": "..."        // live일 때: SSE 스트림
}
```

또는 더 깔끔하게:
```
GET /api/debate/cache?topic=redevelopment&mode=free
→ 200: 캐시 데이터 반환
→ 404: 캐시 없음 → 프론트가 실시간 생성 API 호출
```

### 5-6. 토론 라이브러리 시스템 (멀티 버전)

> 단순 캐싱을 넘어, 같은 조합에 **여러 버전의 토론이 축적**되는 구조.

**동작 플로우**:
```
사용자 A: 재개발×자유토론 최초 요청
  → 실시간 생성 → v1 저장 → v1 재생

사용자 B: 같은 조합 요청
  → v1 캐시 재생

사용자 C: "새 토론 생성" 클릭
  → 실시간 생성 → v2 저장

사용자 D: 같은 조합 요청
  → v1 또는 v2 랜덤 재생

... 시간이 지나면 v1, v2, v3... 라이브러리가 쌓임
```

**Supabase 스키마 수정**:
```sql
CREATE TABLE debate_cache (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  topic_id TEXT NOT NULL,
  mode TEXT NOT NULL,
  candidate_a TEXT NOT NULL,
  candidate_b TEXT NOT NULL,
  version INT NOT NULL DEFAULT 1,
  messages JSONB NOT NULL,
  judgment JSONB NOT NULL,
  play_count INT DEFAULT 0,          -- 재생 횟수 추적
  created_at TIMESTAMPTZ DEFAULT now(),
  
  UNIQUE(topic_id, mode, candidate_a, candidate_b, version)
);

-- 인덱스: 조합별 최신 버전 빠르게 조회
CREATE INDEX idx_debate_combo 
  ON debate_cache(topic_id, mode, candidate_a, candidate_b, version DESC);
```

**재생 전략**:
| 전략 | 설명 |
|------|------|
| 최신 우선 (기본) | 가장 최근 생성된 버전 재생 |
| 랜덤 | 모든 버전 중 랜덤 선택 — 재방문 시 다른 토론 |
| 인기순 | play_count 높은 버전 우선 |

**UI 추가 요소**:
```
┌─────────────────────────────────┐
│ 🥊 토론 종료!                    │
│                                  │
│ [🔄 새 토론 생성]  ← API 호출    │
│ [🔀 다른 토론 보기] ← 다른 버전  │
│ [📋 토론 목록 (v1~v5)]           │
│                                  │
└─────────────────────────────────┘
```

- **"다른 토론 보기"**: 현재 버전 제외하고 랜덤 선택
- **"토론 목록"**: 해당 조합의 모든 버전 리스트 (생성일, 승자 표시)
- **"새 토론 생성"**: 실시간 API 호출 → 새 버전 추가

### 5-7. 관리 기능

- **어드민 대시보드**: 40개 조합별 버전 수 + 총 재생 횟수
- **일괄 생성 스크립트**: `scripts/generate-all-debates.ts`로 초기 40개 v1 생성
- **품질 검수**: 어드민이 특정 버전 삭제/비공개 가능
- **버전 상한**: 조합당 최대 10개 (설정 가능) — 초과 시 play_count 최저 버전 자동 아카이브

### 5-8. 비용 분석

| 항목 | 캐싱 없이 | 라이브러리 적용 |
|------|----------|---------------|
| 1명당 토론 1회 | ~$0.05 | $0 (캐시 재생) |
| "새 토론 생성" 1회 | - | ~$0.05 (사용자 선택 시만) |
| 초기 40조합 v1 | - | ~$2 (1회성) |
| 1만 명 중 1%가 새 토론 생성 | ~$500 | ~$5 |

**결론: 기본 재생은 무료, "새 토론 생성"은 사용자 능동 선택 시만 API 비용 발생**

---

## 6. UI/UX 디자인 명세

### 5-1. 메인 배너

```
┌─────────────────────────────────────┐
│                                      │
│  [오세훈 사진]   ⚡VS⚡   [정원오 사진] │
│                                      │
│     🥊 AI 토론 배틀                   │
│     서울의 미래를 건다                 │
│                                      │
│     [토론 시작하기 →]                 │
│                                      │
└─────────────────────────────────────┘
```

- **배경**: 다크 그라데이션 (#1a1a2e → #16213e)
- **VS 아이콘**: 번개 이펙트, 골드 (#FFD700)
- **CTA 버튼**: 레드 계열 (#FF4444), 펄스 애니메이션

### 5-2. 후보 색상 테마

| 후보 | 메인 컬러 | 서브 컬러 | 배경 | 의미 |
|------|----------|----------|------|------|
| 오세훈 | `#2563EB` (블루) | `#DBEAFE` | `#EFF6FF` | 국민의힘 파란색 |
| 정원오 | `#DC2626` (레드) | `#FEE2E2` | `#FEF2F2` | 더불어민주당 빨간색 |

### 5-3. 토론 화면 와이어프레임

```
┌──────────────────────────────────────────┐
│ [←]  🥊 자유 토론          ⏱️ R 2/5     │ ← 헤더
│ ━━━━━━━━━━━━━█████░░░░━━━━━━━━━━━━━━━━━ │ ← 진행률바
├──────────────────────────────────────────┤
│                                           │
│  ┌─🔵──────────────────────────────────┐ │
│  │ 오세훈 시장                          │ │ ← 블루 보더
│  │                                      │ │
│  │ "서울의 낡은 주거환경을 개선하려면    │ │
│  │  재건축·재개발이 불가피합니다..."     │ │
│  │                           ▌ (커서)   │ │ ← 타이핑 중
│  │                        287/300자     │ │
│  └──────────────────────────────────────┘ │
│                                           │
│  ┌─🔴──────────────────────────────────┐ │
│  │ 정원오 구청장               대기 중   │ │ ← 레드 보더, 흐리게
│  └──────────────────────────────────────┘ │
│                                           │
│  --- 이전 라운드 ---                      │
│                                           │
│  ┌─🔵──────────────────────────────────┐ │
│  │ 오세훈 시장 (라운드 1)               │ │
│  │ "안녕하십니까, 서울시장 오세훈..."    │ │
│  └──────────────────────────────────────┘ │
│                                           │
│  ┌─🔴──────────────────────────────────┐ │
│  │ 정원오 구청장 (라운드 1)             │ │
│  │ "반갑습니다, 성동구청장 정원오..."    │ │
│  └──────────────────────────────────────┘ │
│                                           │
├──────────────────────────────────────────┤
│  [📢 질문하기]            [⏭️ 다음] 🔥  │ ← 하단 액션바
└──────────────────────────────────────────┘
```

### 5-4. 애니메이션 포인트

| 위치 | 애니메이션 | 설명 |
|------|----------|------|
| 토론 시작 | 카운트다운 3→2→1→🥊 | 풀스크린 오버레이, 펀치 이펙트 |
| 발언자 전환 | 슬라이드 + 페이드 | 현재 발언자 카드 강조, 대기자 흐리게 |
| 텍스트 생성 | 타이핑 커서 깜빡 | 실시간 스트리밍 느낌 |
| VS 충돌 | 셰이크 + 스파크 | 반박 발언 시작 시 |
| 판정 발표 | 봉투 오픈 → 스코어 카운트업 | 0에서 최종 점수까지 증가 |
| 승자 발표 | 왕관 낙하 + 컨페티 | 승자 프로필 위에 👑 |

---

## 7. 승자 판정 시스템

### 6-1. AI 판정 기준 (4개 항목, 각 10점)

| 기준 | 설명 | 가중치 |
|------|------|--------|
| **논리력** (Logic) | 주장의 논리적 일관성, 근거 제시 | 30% |
| **구체성** (Specificity) | 구체적 정책·수치·사례 제시 | 25% |
| **설득력** (Persuasion) | 시민 관점에서 공감 가능한 메시지 | 25% |
| **실현가능성** (Feasibility) | 실제 실행 가능한 정책인지 | 20% |

### 6-2. 판정 프롬프트

```
[시스템] 당신은 공정한 토론 심판입니다.

아래 토론 내용을 읽고 4개 기준으로 각 후보에게 1~10점을 매기세요.
가중치: 논리력 30%, 구체성 25%, 설득력 25%, 실현가능성 20%.

규칙:
- 정당이나 이념이 아닌 토론 내용만으로 판단
- 동점 가능 (5:5 허용)
- 각 항목별 점수 이유를 한 줄로 설명
- 최종 총평은 3문장 이내

[토론 내용]
{전체 토론 대화}
```

### 6-3. 판정 UI

```
┌─────────────────────────────────────┐
│         🏆 AI 판정 결과              │
│                                      │
│    오세훈          정원오             │
│     43    :    57                     │
│                                      │
│  ── 상세 평가 ──                     │
│                                      │
│  논리력     ███████░░░ 7 : 8 ████████░░ │
│  구체성     ████████░░ 8 : 7 ███████░░░ │
│  설득력     ██████░░░░ 6 : 8 ████████░░ │
│  실현가능   ████████░░ 8 : 7 ███████░░░ │
│                                      │
│  💬 AI 심판 총평                     │
│  "이번 토론에서 정원오 후보는 성동구  │
│   실제 사례를 통해 높은 설득력을 보여 │
│   줬습니다. 오세훈 시장은 구체적 수치 │
│   제시가 강점이었으나..."             │
│                                      │
│  [🔄 같은 주제 재토론]               │
│  [📋 다른 주제 선택]                 │
│  [📤 결과 공유]                      │
└─────────────────────────────────────┘
```

**판정 공개 연출**:
1. "AI 심판이 판정 중입니다..." (3초 로딩)
2. 봉투 열기 애니메이션
3. 총점 카운트업 (0 → 최종점수)
4. 항목별 바 차트 순차 등장
5. 승자에게 👑 + 컨페티

---

## 부록: 구현 우선순위 제안

| 순서 | 항목 | 난이도 | 비고 |
|------|------|--------|------|
| 1 | 자유 토론 + 1개 주제 | ⭐⭐ | MVP — 핵심 스트리밍 + 턴 관리 |
| 2 | 판정 시스템 | ⭐ | 별도 API 호출 1회로 간단 |
| 3 | 나머지 주제 9개 | ⭐ | 데이터만 추가 |
| 4 | 정책 디베이트 모드 | ⭐⭐ | 라운드 구조만 다름 |
| 5 | 시민 타운홀 모드 | ⭐⭐⭐ | 사용자 입력 처리 추가 |
| 6 | 최후 변론 배틀 | ⭐ | 가장 단순한 구조 |
| 7 | 애니메이션·연출 | ⭐⭐⭐ | 폴리싱 단계 |

---

*문서 끝. 2026-02-18 작성.*
